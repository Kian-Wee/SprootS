<!-- reference taken from https://github.com/acrobotic/Ai_Demos_ESP8266/blob/master/bmp180_gui/bmp180_gui.ino-->

<!-- a download="filename" https://www.w3schools.com/tags/tag_dialog.asp-->

<html>

<head>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js'></script>
</head>
<body onload="javascript:init()">
<!-- Adding a slider for controlling data rate -->
<div>
  <input type="range" min="1" max="10" value="5" id="dataRateSlider" oninput="sendDataRate()" />
  <label for="dataRateSlider" id="dataRateLabel">Rate: 0.2Hz</label>
</div>
<hr />
<div>
  <canvas id="temperature-line-chart" width="800" height="450"></canvas>
</div>
<div>
  <canvas id="moisture-line-chart" width="800" height="450"></canvas>
</div>
<div>
  <canvas id="light-line-chart" width="800" height="450"></canvas>
</div>
<div>
  <canvas id="battery-line-chart" width="800" height="450"></canvas>
</div>
<div>
  <canvas id="pressure-line-chart" width="800" height="450"></canvas>
</div>

<!-- Adding a websocket to the client (webpage) -->
<script>

  var webSocket, tempearturePlot, moistureplot, lightplot, batteryplot, perssureplot;
  var maxDataPoints = 20;

  function removeData(dataPlot){
    dataPlot.data.labels.shift();
    dataPlot.data.datasets[0].data.shift();
  }

  function addData(dataPlot, label, data) {
    if(dataPlot.data.labels.length > maxDataPoints) removeData(dataPlot);
    dataPlot.data.labels.push(label);
    dataPlot.data.datasets[0].data.push(data);
    dataPlot.update();
  }

  function init() {

    webSocket = new WebSocket(`ws://${window.location.hostname}/ws`);

    temperaturePlot = new Chart(document.getElementById("temperature-line-chart"), {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          data: [],
          label: "Temperature (C)",
          borderColor: "#3e95cd",
          fill: false
        }]
      }
    });
    moisturePlot = new Chart(document.getElementById("moisture-line-chart"), {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          data: [],
          label: "Moisture (%)",
          borderColor: "#3e95cd",
          fill: false
        }]
      }
    });
    lightPlot = new Chart(document.getElementById("light-line-chart"), {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          data: [],
          label: "Light (lux)",
          borderColor: "#3e95cd",
          fill: false
        }]
      }
    });
    batteryPlot = new Chart(document.getElementById("battery-line-chart"), {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          data: [],
          label: "Battery (%)",
          borderColor: "#3e95cd",
          fill: false
        }]
      }
    });
    pressurePlot = new Chart(document.getElementById("pressure-line-chart"), {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          data: [],
          label: "Pressure (Pa)",
          borderColor: "#3e95cd",
          fill: false
        }]
      }
    });

    webSocket.onmessage = function(event) {
      var data = JSON.parse(event.data);
      var today = new Date();
      var t = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
      addData(temperaturePlot, t, data.temperature);
      addData(moisturePlot, t, data.Features.moisture);
      addData(lightPlot, t, data.light);
      addData(batteryPlot, t, data.battery);
      addData(pressurePlot, t, data.pressure);
    }
  }
  function sendDataRate(){
    var dataRate = document.getElementById("dataRateSlider").value;
    webSocket.send(dataRate);
    dataRate = 1.0/dataRate;
    document.getElementById("dataRateLabel").innerHTML = "Rate: " + dataRate.toFixed(2) + "Hz";
  }
</script>
</body>
</html>